"0",""
"0","make_adm2_pop_plot <- function(tbl, county_filter) {"
"0","  "
"0","  tbl %>% "
"0","    filter(county == county_filter) %>% "
"0","    right_join(pcode2_shape %>% "
"0","                 select(-fo) %>% "
"0","                 filter(adm1_en == county_filter)) %>% "
"0","    st_as_sf() %>% "
"0","    ggplot() + "
"0","    geom_sf(aes(fill = children_0_17), "
"0","            size = 0.001, colour = ""grey70"") + "
"0","    scale_fill_viridis(option = ""mako"", direction = -1, "
"0","                       trans = ""log10"", "
"0","                       labels = number_format(scale = 1/1000, suffix = ""K""), "
"0","                       begin = .1) + "
"0","    geom_sf(size = .1, colour = ""#f5908e"", alpha = .7,"
"0","            data = "
"0","              roads %>% st_intersection(pcode1_shape %>% filter(adm1_en == county_filter))) +"
"0","    geom_point(aes(x = lon, y = lat), "
"0","               data = all_towns_shape %>% "
"0","                 st_as_sf() %>% "
"0","                 mutate(lon = sf::st_coordinates(.)[,1],"
"0","                  lat = sf::st_coordinates(.)[,2]) %>% "
"0","                 st_intersection(., pcode2_shape %>% filter(adm1_en == county_filter)) %>% "
"0","                 st_make_valid(), "
"0","               colour = ""#f04743"", pch = 15, alpha = .7) + "
"0","    geom_sf_label_repel(aes(label = paste0(adm2_en, ""\n"","
"0","                                           ""Population: "", comma(population), ""\n"","
"0","                                           ""Children: "", comma(children_0_17), ""\n"", "
"0","                                           ""Poverty rate: "", poverty_incidence)),"
"0","                  size = 1.5, "
"0","                  alpha = .7, "
"0","                  fill = ""#f3f6f4"", "
"0","                  seed = 12) +"
"0","      theme_void() + "
"0","      theme(plot.background = element_rect(fill = ""white"", "
"0","                                           colour = ""white""),"
"0","            plot.title = element_text(size = 10), "
"0","          plot.subtitle = element_text(size = 8)) +"
"0","      labs(title = paste0(""Total population in "", county_filter),"
"0","           subtitle = ""Red squares are town and cities; road network in pink"","
"0","           fill = ""Children"")"
"0","    "
"0","}"
